# アクティブコンテキスト

## 現在の作業フォーカス

現在のプロジェクトフェーズは、**基本実装段階**です。基本的なアプリケーション構造が実装され、主要な機能のモック実装が完了しています。ストレージレイヤーとネットワーク通信のモック実装から本格的な実装への移行が進行中です。

### 主な焦点領域

1. **iroh-docsの本格的な実装**: 現在はモック実装ですが、iroh-docsを使用した本格的な分散型データストレージを実装する必要があります。ストレージマネージャー、変更トラッカー、同期マネージャーなどの基本的なインフラストラクチャは実装済みです。
2. **iroh-gossipの実装の完成**: iroh-gossipの基本的な実装は進行中で、MessageType、IrohNetwork構造体、トピックベースのメッセージング機能などが実装されています。しかし、実際のP2P通信の検証やエラーハンドリングの改善が必要です。
3. **UIの改善**: 基本的なUIは実装されていますが、ユーザーエクスペリエンスの向上のために改善が必要です。
4. **テストの実装**: ユニットテスト、統合テスト、E2Eテストを実装する必要があります。テスト用の依存関係（tokio, mockall, test-log, env_logger）は追加済みで、基本的なテスト構造も実装されています。
5. **パフォーマンスの最適化**: データ同期やP2P通信のパフォーマンスを最適化する必要があります。

## 最近の変更

1. **基本的なアプリケーション構造の実装**:
   - フロントエンド: React、TypeScript、Zustandを使用したUI実装
   - バックエンド: Tauriコマンドを使用したRust実装
   - データモデル: Zodスキーマを使用したデータモデル定義

2. **iroh-gossipの実装進行**:
   - iroh-gossipの依存関係の追加
   - MessageType列挙型の定義（NewPost, UpdateProfile, Follow, Unfollow, SyncRequest, SyncResponse）
   - IrohNetwork構造体の実装
   - トピックベースのメッセージング機能の実装
   - publish_post, publish_profile, publish_follow, publish_unfollowなどの関数の実装
   - 基本的なテスト構造の実装

2. **主要機能の実装**:
   - ユーザー認証: ユーザー作成、サインイン、ユーザーリスト取得
   - 投稿管理: 投稿作成、取得、検索
   - プロフィール管理: プロフィール取得、更新
   - フォロー機能: フォロー、アンフォロー

3. **ストレージとネットワークのモック実装**:
   - JSONファイルを使用したシンプルなストレージ
   - モックネットワークを使用したシンプルな通信

4. **ストレージ技術の変更**:
   - Automergeからiroh-docsへの移行を決定
   - iroh-docsはより効率的な同期プロトコルを提供し、iroh-gossipとiroh-blobsと統合されている
   - 移行作業を開始
   - ストレージマネージャー、変更トラッカー、同期マネージャーなどの基本的なインフラストラクチャを実装

5. **データモデルの実装**:
   - User, Postなどの基本的なデータモデルを実装
   - HasId, PostTraitなどのトレイトを定義
   - シリアライズ/デシリアライズのサポート

## 次のステップ

### 短期的なタスク（1-2週間）

1. **iroh-docsの実装**:
   - iroh-docsの依存関係の追加
   - モック実装から実際のiroh-docsへの移行
   - データモデルの適応
   - 既存のストレージマネージャーとの統合

2. **iroh-gossipの実装完成**:
   - 実際のP2P通信のテストと検証
   - エラーハンドリングの改善
   - パフォーマンスの最適化
   - 実際のネットワーク環境でのテスト

3. **テスト実装の拡充**:
   - ユニットテストの追加
   - 統合テストの実装
   - P2P通信のテスト方法の確立
   - モックを活用したテストの実装

### 中期的なタスク（3-5週間）

1. **ユーザー認証とプロフィール管理の強化**
2. **投稿作成と表示機能の強化**
3. **タイムラインの最適化**
4. **P2P通信の最適化**
5. **フォロー/フォロワー機能の強化**

## アクティブな決定事項

1. **技術スタックの選択**:
   - フロントエンド: React、TypeScript、Vite、Zustand、TanStack Query
   - バックエンド: Tauri、Rust、iroh-docs、iroh-gossip、iroh-blobs
   - テスト: Vitest、Playwright、Mockall、tokio-test、test-log、env_logger

2. **アーキテクチャの決定**:
   - クライアントサイドアプリケーション
   - 分散型P2Pネットワーク
   - ローカルファーストデータ管理
   - モジュール型サービス統合
   - トピックベースのメッセージング

3. **データモデルの設計**:
   - ユーザープロフィール（User）
   - 投稿（Post）
   - フォロー関係
   - メッセージタイプ（MessageType列挙型）
   - ネットワークステータス（NetworkStatus）

4. **実装アプローチ**:
   - 段階的な実装（MVP→拡張機能→エコシステム拡大→スケーリング）
   - テスト駆動開発
   - モジュール化されたコードベース
   - エラーハンドリングの標準化（thiserrorを使用）

5. **ストレージ技術の変更**:
   - Automergeからiroh-docsへの移行
   - より効率的な同期プロトコルの採用
   - iroh-gossipとiroh-blobsとの統合

## 現在の考慮事項

1. **パフォーマンス最適化**:
   - iroh-docsのデータ構造の最適化
   - P2P通信の効率化（特にトピックベースのメッセージング）
   - リソース使用量の最適化（メモリ、CPU、ネットワーク帯域）
   - 変更トラッカーの効率的な実装
   - 大量のメッセージ処理時のパフォーマンス

2. **セキュリティ考慮事項**:
   - ユーザーデータの保護
   - 通信の暗号化（iroh-gossipの暗号化機能の活用）
   - 権限管理
   - 秘密鍵の安全な保存（現在はtempディレクトリに保存）
   - メッセージの認証と検証

3. **ユーザーエクスペリエンス**:
   - オンボーディングプロセスの設計
   - UIの使いやすさ
   - オフライン対応
   - エラーハンドリングの改善（ユーザーフレンドリーなエラーメッセージ）
   - ネットワーク状態の表示

4. **スケーラビリティ**:
   - 大規模データセットの処理
   - 多数のユーザーとの同期
   - リソース使用量の管理
   - 効率的なデータ同期メカニズム
   - トピック数の増加に対する対応

5. **テスト戦略**:
   - ユニットテスト（基本構造は実装済み）
   - 統合テスト
   - E2Eテスト
   - パフォーマンステスト
   - モックの活用（mockallを使用）
   - P2P通信のテスト方法

## オープンな質問

1. **iroh-docsのパフォーマンス**: 大規模データセットでのiroh-docsのパフォーマンスはどうか？特に多数のエントリーを持つドキュメントの同期パフォーマンスはどうか？
2. **iroh-gossipのスケーラビリティ**: 多数のユーザーがいる場合のiroh-gossipのスケーラビリティはどうか？トピックベースのメッセージングの効率はどうか？実装したトピック設計は効率的か？
3. **クロスプラットフォーム互換性**: 異なるプラットフォーム間での一貫したユーザーエクスペリエンスをどのように確保するか？特にTauriアプリケーションのプラットフォーム固有の挙動をどう扱うか？
4. **オフライン対応**: オフライン状態でのユーザーエクスペリエンスをどのように最適化するか？特に同期の競合解決をどのように実装するか？
5. **モデレーション**: 分散型システムでのコンテンツモデレーションをどのように実装するか？ユーザー主導のモデレーションメカニズムは可能か？
6. **テスト戦略**: 分散型システムのテストをどのように効果的に実装するか？特にP2P通信のテストをどのように行うか？モックを使用したテストは十分か？
7. **秘密鍵管理**: 現在の秘密鍵保存方法（tempディレクトリ）は本番環境に適しているか？より安全な保存方法は？
8. **エラーハンドリング**: 現在のエラーハンドリング（thiserrorを使用）は十分か？ユーザーフレンドリーなエラーメッセージをどのように提供するか？
9. **トピック設計**: 現在のトピック設計（global/posts, user/{id}/posts, user/{id}/profile, user/{id}/following）は効率的か？より良い設計はあるか？